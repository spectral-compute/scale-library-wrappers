#include "common.hpp"

#include <curand.h>

namespace
{

unsigned int EXPECTED_HOST[128] =
{
    0, 2147483648, 3221225472, 1073741824, 1610612736, 3758096384, 2684354560, 536870912, 805306368, 2952790016,
    4026531840, 1879048192, 1342177280, 3489660928, 2415919104, 268435456, 402653184, 2550136832, 3623878656,
    1476395008, 2013265920, 4160749568, 3087007744, 939524096, 671088640, 2818572288, 3892314112, 1744830464,
    1207959552, 3355443200, 2281701376, 134217728, 201326592, 2348810240, 3422552064, 1275068416, 1811939328,
    3959422976, 2885681152, 738197504, 1006632960, 3154116608, 4227858432, 2080374784, 1543503872, 3690987520,
    2617245696, 469762048, 335544320, 2483027968, 3556769792, 1409286144, 1946157056, 4093640704, 3019898880,
    872415232, 603979776, 2751463424, 3825205248, 1677721600, 1140850688, 3288334336, 2214592512, 67108864,
    100663296, 2248146944, 3321888768, 1174405120, 1711276032, 3858759680, 2785017856, 637534208, 905969664,
    3053453312, 4127195136, 1979711488, 1442840576, 3590324224, 2516582400, 369098752, 503316480, 2650800128,
    3724541952, 1577058304, 2113929216, 4261412864, 3187671040, 1040187392, 771751936, 2919235584, 3992977408,
    1845493760, 1308622848, 3456106496, 2382364672, 234881024, 167772160, 2315255808, 3388997632, 1241513984,
    1778384896, 3925868544, 2852126720, 704643072, 973078528, 3120562176, 4194304000, 2046820352, 1509949440,
    3657433088, 2583691264, 436207616, 301989888, 2449473536, 3523215360, 1375731712, 1912602624, 4060086272,
    2986344448, 838860800, 570425344, 2717908992, 3791650816, 1644167168, 1107296256, 3254779904, 2181038080,
    33554432
};

struct HostRNG final
{
    void operator()(unsigned int* gpuBuf)
    {
        curandGenerator_t gen;
        EXPECT_EQ(CURAND_STATUS_SUCCESS, curandCreateGenerator(&gen, CURAND_RNG_QUASI_SOBOL32));
        EXPECT_EQ(CURAND_STATUS_SUCCESS, curandGenerate(gen, gpuBuf, 128));
    }
};

TEST(CuRand_Host, Sobol32)
{
    doTest<HostRNG>(EXPECTED_HOST);
}

} // namespace
